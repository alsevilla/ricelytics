{% extends 'main.html' %}
{% load static %}
{% block content %}
<!-- Body -->
<div class="sublevel container">
    <!-- Header --->
    <div class="jumbotron">
        <div class="jumbotron-content text-center">
            <h2>State of the Rice Sector in the Philippines</h2>
            <h1>{{title}}</h1>
            <p class="lead">Estimated total paddy rice production (in million metric tons) for all ecosystems, 2000-2020</p>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div class="card-deck mb-2 text-center">
                <div class="card primary mb-4 bg-alternate">
                    <div class="card-body">
                        <h5 class="card-title p-2">Production - Irrigated ({{ irrigated_year }})</h5>
                        <h1 class="card-text font-weight-bold">{{ irrigated_value }}<i class="bi bi-caret-up-fill"></i></h1>
                        <div class="card-note w-50 mx-auto rounded-pill bg-primary">
                            <p class="text-white">million metric tons</p>
                        </div>
                    </div>
                </div>
                <div class="card primary mb-4 bg-primary text-white">
                    <div class="card-body">
                        <h5 class="card-title p-2">Rice Production ({{ all_eco_year }})</h5>
                        <h1 class="card-text font-weight-bold">{{ all_eco_value }}<i class="bi bi-caret-up-fill"></i></h1>
                        <div class="card-note w-50 mx-auto rounded-pill">
                            <p class="text-dark">million metric tons</p>
                        </div>
                    </div>
                </div>
                <div class="card primary mb-4 bg-alternate">
                    <div class="card-body">
                        <h5 class="card-title p-2">Production - Non-Irrigated ({{non_irrigated_year}})</h5>
                        <h1 class="card-text font-weight-bold">{{non_irrigated_value}}<i class="bi bi-caret-up-fill"></i></h1>
                        <div class="card-note w-50 mx-auto rounded-pill bg-primary">
                            <p class="text-white">million metric tons</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div class="card mb-4">
                <div class="card-header text-center">
                    <h5 class="my-0 p-2">Yearly estimated rice production by ecosystem (2000-2020)</h5>
                    <p class="my-0 font-weight-normal text-muted">in million metric tons (PSA, 2020)</p>
                </div>
                <div class="card-body">
                    <div><canvas id="ctxProdStack"></canvas></div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div class="card mb-4">
                <div class="card-header text-center">
                    <h5 class="my-0 p-2">Total rice production by province (2020)</h5>
                    <p class="my-0 font-weight-normal text-muted">in million metric tons (PSA, 2020)</p>
                </div>
                <div class="card-body">
                    <div><canvas id="ctxTopProv"></canvas></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer --->
    <footer class="pt-4 my-md-5 pt-md-5 border-top">
        <div class="row">
            <div class="col-12 col-md">
                <small class="d-block mb-3 text-muted">2021. RiceLytics Data Initative.</small>
                <small class="text-muted">Philippine Rice Research Institute.</small>
            </div>
            <div class="col-6 col-md">
                <h5>State of the Rice Sector</h5>
                <ul class="list-unstyled text-small">
                    <li><a class="text-muted" href="#">Rice Production</a></li>
                    <li><a class="text-muted" href="#">Area Harvested</a></li>
                    <li><a class="text-muted" href="#">Yield per Hectare</a></li>
                    <li><a class="text-muted" href="#">Supply and Utilization</a></li>
                    <li><a class="text-muted" href="#">Gross Value Added</a></li>
                    <li><a class="text-muted" href="#">Farmerâ€™s Income</a></li>
                    <li><a class="text-muted" href="#">Palay & Rice Prices</a></li>
                </ul>
            </div>
            <div class="col-6 col-md">
                <h5>Rice Farmer Characteristics</h5>
                <ul class="list-unstyled text-small">
                    <li><a class="text-muted" href="#">Sociodemographics</a></li>
                    <li><a class="text-muted" href="#">Farm Details</a></li>
                    <li><a class="text-muted" href="#">Technology Awareness</a></li>
                </ul>
            </div>
            <div class="col-6 col-md">
                <h5>RCEF Updates</h5>
                <ul class="list-unstyled text-small">
                    <li><a class="text-muted" href="#">Inbred Seeds</a></li>
                    <li><a class="text-muted" href="#">Machineries</a></li>
                    <li><a class="text-muted" href="#">Extension</a></li>
                    <li><a class="text-muted" href="#">Credit</a></li>
                    <li>{{location_name}}</li>
                </ul>
            </div>
        </div>
    </footer>
</div>
{% endblock content %}
{% block script %}
<script>
    Chart.defaults.global.responsive = true;
    Chart.defaults.global.tooltips.mode = 'index';
    Chart.defaults.global.tooltips.intersect = false;
    Chart.defaults.global.defaultFontFamily = 'Poppins';
    Chart.defaults.global.defaultFontSize = 13;
    Chart.defaults.global.animation.duration = 3000;

    // CHART 1
    var dbTotal ={{ aeData|safe }};
    var dbIrrigated = {{ iData|safe }};
    var dbRainfed = {{ rfData|safe }};

    let years = [];
    let values_total = [];
    let values_irrig = [];
    let values_rain = [];

    try {
        dbTotal.map((item) => {
            years.push(item.year);
            values_total.push(item.value);
        });
        dbIrrigated.map((item) => {
            values_irrig.push(item.value);
        });
        dbRainfed.map((item) => {
            values_rain.push(item.value);
        });
    } catch (error) {
        console.log(error);
    }

    var prodStack = document.getElementById('ctxProdStack').getContext('2d');
    var tempPLabels = [...years];
    var prodAllData = [...values_total];
    var prodIrrigData = [...values_irrig];
    var prodRainData = [...values_rain];
    var prodStackChart = new Chart(prodStack, {

        type: 'bar',

        data: {
            labels: tempPLabels,
            datasets: [{
                    label: 'All ecosystems',
                    backgroundColor: '#007FFE', // COLOR 1
                    borderColor: '#007FFE', // COLOR 1
                    lineTension: 0,
                    type: 'line',
                    fill: false,
                    data: prodAllData,
                    pointStyle: 'line'
                },
                {
                    label: 'Irrigated',
                    backgroundColor: '#2138B7', // COLOR 2
                    borderColor: '#2138B7', // COLOR 2
                    data: prodIrrigData
                },
                {
                    label: 'Rainfed',
                    backgroundColor: '#A6CEE3', // COLOR 3
                    borderColor: '#A6CEE3', // COLOR 3
                    data: prodRainData
                }
            ]
        },

        options: {
            aspectRatio: 2.5,
            scales: {
                xAxes: [{
                    stacked: true,
                    display: true,
                    gridLines: {
                        color: "rgba(0, 0, 0, 0)"
                    }
                }],
                yAxes: [{
                    stacked: true,
                    display: true,
                    ticks: {
                        suggestedMin: 0,
                        stepSize: 5

                    }
                }]
            },
            legend: {
                position: 'bottom'
            }
        }
    });

    // CHART 2

    var dbProvs = {{ tpData|safe }};
    let provinces = [];
    let values = [];

    try {
        dbProvs.map((item) => {
            provinces.push(item.location_name);
            values.push(item.value);
        });
    } catch (error) {
        console.log(error);
    }

    var prodStack = document.getElementById('ctxProdStack').getContext('2d');
    var tempPrLabels = [...provinces];
    var topProvData = [...values];

    var topProv = document.getElementById('ctxTopProv').getContext('2d');
    var topProvChart = new Chart(topProv, {
        // The type of chart we want to create
        type: 'horizontalBar',

        data: {
            labels: tempPrLabels,
            datasets: [{
                label: 'Provincial total production',
                backgroundColor: '#2138B7', // COLOR 4
                borderColor: '#2138B7', // COLOR 4
                fill: false,
                data: topProvData
            }]
        },

        options: {
            aspectRatio: 0.5,
            scales: {
                xAxes: [{
                    display: true,
                }],
                yAxes: [{
                    display: true,
                    ticks: {
                        suggestedMin: 0,
                    },
                    gridLines: {
                        color: "rgba(0, 0, 0, 0)"
                    }
                }]
            },
            legend: {
                display: false
            }
        }
    });

    </script>
{% endblock script %}
